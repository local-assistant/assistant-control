# Assistant Control - Project Outline

## Project Overview

**Assistant Control** is a VS Code extension that provides a user interface for managing and monitoring autonomous assistant tasks. It enables developers to submit tasks to a backend autonomous assistant service, track task execution in real-time, view logs, manage task outputs, and control task lifecycle (cancel/retry operations).

The extension bridges the gap between VS Code and a backend API (running on `http://127.0.0.1:8000`) that handles autonomous task execution.

---

## Project Motive

This extension addresses the need for developers to:
1. **Submit tasks** to an autonomous assistant without leaving VS Code
2. **Monitor task execution** with a visual, organized task list
3. **View real-time logs** and track progress as tasks execute
4. **Manage task results** by opening generated output files
5. **Control tasks** by canceling running tasks or retrying failed ones

---

## Tech Stack

- **Framework**: VS Code Extension API
- **Language**: TypeScript
- **Bundler**: Webpack
- **Build Tool**: npm scripts with webpack
- **Runtime**: Node.js (VS Code extensions run in Node.js context)
- **HTTP Client**: node-fetch
- **Linter**: ESLint
- **Test Framework**: Mocha with VS Code Test Runner

---

## Project Structure

```
assistant-control/
├── src/
│   ├── extension.ts          # Main extension entry point, command handlers
│   ├── taskTree.ts           # Task tree provider & task tree item classes
│   └── test/
│       └── extension.test.ts  # Extension tests
├── media/
│   └── list-check.png        # Activity bar icon
├── dist/                     # Compiled & bundled output (generated)
├── out/                      # Compiled test files (generated)
├── package.json              # Extension manifest & dependencies
├── tsconfig.json             # TypeScript configuration
├── webpack.config.js         # Webpack bundling configuration
├── eslint.config.mjs         # ESLint configuration
├── CHANGELOG.md              # Version history
├── README.md                 # Extension documentation
├── vsc-extension-quickstart.md  # Quick start guide
└── PROJECT_OUTLINE.md        # This file
```

---

## Core Components

### 1. Extension Entry Point (`src/extension.ts`)

**Purpose**: Main extension activation and command registration.

**Key Responsibilities**:
- Registers VS Code commands
- Sets up the task tree data provider for the sidebar
- Manages auto-refresh intervals for task lists and logs
- Handles clipboard-based task submission
- Manages task logs in real-time text documents
- Cleans up resources on deactivation

**Commands Registered**:
- `assistant.sendClipboardAsTask` - Submit a task from clipboard (Ctrl+Alt+Enter)
- `assistant.refreshTasks` - Manually refresh the task list
- `assistant.viewTaskLogs` - Display real-time logs for a task
- `assistant.openTaskResult` - Open output files generated by a task
- `assistant.cancelTask` - Cancel a running task
- `assistant.retryTask` - Retry a failed or cancelled task

**Key Functions**:
- `extractTask(text)` - Parses clipboard text looking for "Create task:" prefix
- `submitTask(description)` - POSTs task to backend API
- `fetchTaskLogs(taskId)` - Fetches logs for a specific task
- `fetchTaskOutputs(taskId)` - Fetches output file paths for a task
- `cancelTask(taskId)` - Cancels an executing task
- `retryTask(taskId)` - Retries a failed/cancelled task

### 2. Task Tree Provider (`src/taskTree.ts`)

**Purpose**: Implements the tree view that displays tasks in the Activity Bar sidebar.

**Key Classes**:

#### `Task` Interface
```typescript
{
  id: number
  description: string
  status: string  // e.g., "running", "done", "failed", "cancelled"
}
```

#### `TaskItem` (extends `vscode.TreeItem`)
- Represents a single task in the tree view
- Displays: `#<id> — <status>` with description as hover text
- Sets context value for context menu visibility based on task status
- Links to `assistant.viewTaskLogs` command on click

#### `TaskTreeProvider` (implements `vscode.TreeDataProvider`)
- Fetches tasks from backend API (`GET /tasks`)
- Converts task data into `TaskItem` objects
- Provides change notifications for auto-refresh
- Handles tree refresh events

---

## API Integration

The extension communicates with a backend autonomous assistant API at `http://127.0.0.1:8000`.

### API Endpoints Used

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/tasks` | Fetch all tasks |
| POST | `/tasks` | Submit a new task |
| GET | `/tasks/{taskId}/logs` | Fetch logs for a task |
| GET | `/tasks/{taskId}/outputs` | Fetch output files for a task |
| POST | `/tasks/{taskId}/cancel` | Cancel a running task |
| POST | `/tasks/{taskId}/retry` | Retry a failed task |

---

## UI/UX Components

### 1. Activity Bar Sidebar
- **Icon**: `list-check.png` (checkbox icon)
- **Title**: "Assistant"
- **View**: "Tasks" - displays hierarchical task list

### 2. Commands Palette
All commands are accessible via VS Code command palette with `assistant.*` prefix.

### 3. Context Menu (Right-click on Task)
- **Open Task Result** - Available for completed/failed/cancelled tasks
- **Cancel Task** - Available for running tasks only
- **Retry Task** - Available for failed/cancelled tasks only

### 4. Keyboard Shortcut
- `Ctrl+Alt+Enter` - Quick submit task from clipboard

### 5. Log Viewer
- Dynamic text editor that auto-refreshes logs every 2 seconds
- Supports syntax highlighting (marked as "log" language)
- Auto-refresh stops when tab is closed

---

## Extension Configuration

### In `package.json`

#### Contribution Points:
- **viewsContainers**: Activity bar container for the Assistant panel
- **commands**: 6 commands for task management
- **keybindings**: Ctrl+Alt+Enter for clipboard submission
- **views**: Task tree view UI
- **menus**: Context menu items for task interactions

#### Activation Events:
- Currently empty (extension activates on-demand with first command)

#### Entry Point:
- `./dist/extension.js` (compiled output)

---

## Development & Build Process

### NPM Scripts

| Script | Purpose |
|--------|---------|
| `npm run compile` | Single webpack build for development |
| `npm run watch` | Continuous webpack build on file changes |
| `npm run watch-tests` | TypeScript compilation for tests in watch mode |
| `npm run package` | Production build with minification & hidden source maps |
| `npm run lint` | Run ESLint on src/ |
| `npm run test` | Run all tests (requires compile, lint) |
| `npm run pretest` | Pre-test hook (compiles TypeScript, webpack, lints) |

### Webpack Configuration (`webpack.config.js`)

- **Target**: Node.js (VS Code extension runtime)
- **Entry**: `./src/extension.ts`
- **Output**: `./dist/extension.js` (CommonJS format)
- **Externals**: `vscode` module (provided by VS Code at runtime)
- **Loaders**: `ts-loader` for TypeScript transpilation
- **Source Maps**: nosources-source-map (doesn't expose source code)

### TypeScript Configuration (`tsconfig.json`)

- Configured for Node.js target
- ES2020 module format
- Strict type checking enabled

---

## Key Features

### 1. Task Submission from Clipboard
- Users paste text starting with "Create task:" 
- Confirmation dialog prevents accidental submissions
- Task sent to backend, confirmation message shown

### 2. Real-Time Task List
- Auto-refreshes every 3 seconds
- Shows task ID, status, and description
- Color-coded or styled based on task status

### 3. Live Task Logs
- Opens a text editor showing task logs
- Auto-refreshes every 2 seconds during execution
- Logs stop updating when tab is closed
- Handles missing logs gracefully ("No logs yet")

### 4. Output File Management
- Displays available output files in a quick-pick menu
- Opens selected files in VS Code editor
- Assumes output files in `/home/nishant/assistant/tasks/task-{id}/{filename}`

### 5. Task Lifecycle Control
- Cancel running tasks with confirmation
- Retry failed or cancelled tasks
- Context menu items only appear when actions are applicable

---

## Error Handling

- **API Errors**: Caught and shown to user via error messages
- **Empty Clipboard**: Warned to user
- **Invalid Clipboard Format**: User must start with "Create task:"
- **No Task Selected**: Error message if commands invoked without selection
- **Failed API Calls**: Silent failures in log refresh (retries on next tick)
- **No Output Files**: Info message informs user

---

## Resource Management

### Cleanup on Deactivation
- Clears all active log refresh timers
- Removes event listeners
- Disposes of subscriptions
- Prevents memory leaks from abandoned log viewers

### Active Subscriptions
- Stored in `context.subscriptions` for automatic cleanup
- Includes commands, event listeners, and manual disposal handlers

---

## Future Considerations

### Potential Enhancements
1. **Task Filtering/Search** - Filter tasks by status or description
2. **Task History** - Persist completed tasks locally
3. **Batch Operations** - Submit multiple tasks at once
4. **Custom Output Paths** - Configuration for task output directory
5. **Webhook Support** - Receive notifications on task completion
6. **Task Templates** - Save and reuse common task descriptions
7. **Settings Panel** - Configure API endpoint, refresh intervals, etc.
8. **Status Bar Integration** - Show active task count in status bar

---

## Testing

- **Location**: `src/test/extension.test.ts`
- **Framework**: Mocha with VS Code test runner
- **Run**: `npm test` (after compilation and linting)

---

## Dependencies

### Runtime
- `vscode` - VS Code Extension API
- `node-fetch` - HTTP client for API calls

### Dev Dependencies
- `typescript` - TypeScript compiler
- `@types/vscode` - VS Code API types
- `webpack` & `ts-loader` - Bundling & transpilation
- `eslint` - Code linting
- `mocha` & `vscode-test` - Testing framework

---

## Getting Started for New Developers

1. **Install Dependencies**: `npm install`
2. **Compile**: `npm run compile` (or `npm run watch` for continuous builds)
3. **Run Tests**: `npm test`
4. **Debug**: Press `F5` in VS Code to launch extension in debug mode
5. **Lint**: `npm run lint` to check code quality

---

## File Descriptions

| File | Purpose |
|------|---------|
| `extension.ts` | Main extension logic, command handlers, API integration |
| `taskTree.ts` | Task tree view implementation |
| `package.json` | Extension manifest, dependencies, scripts |
| `tsconfig.json` | TypeScript compiler options |
| `webpack.config.js` | Bundler configuration for Node.js target |
| `eslint.config.mjs` | Code quality/style rules |
| `media/list-check.png` | Activity bar sidebar icon |

---

## Summary

**Assistant Control** is a focused, lightweight VS Code extension that provides a control panel for autonomous assistant task management. It demonstrates core VS Code extension patterns including:
- TreeDataProvider implementation
- Command registration and palette integration
- API communication and async operations
- Real-time UI updates with auto-refresh
- Context-sensitive menu items
- Resource lifecycle management

The codebase is clean, well-structured, and ready for additional features as the autonomous assistant backend evolves.
